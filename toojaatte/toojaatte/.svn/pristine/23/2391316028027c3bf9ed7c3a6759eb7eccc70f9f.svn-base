<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>toojaatte:: market index</title>
<link
	href="https://fonts.googleapis.com/css?family=Noto+Sans+KR|Sawarabi+Gothic&display=swap"
	rel="stylesheet">
</head>
<body>
<div class="container">
  <h2>Accordion Example</h2>
  <p><strong>Note:</strong> The <strong>data-parent</strong> attribute makes sure that all collapsible elements under the specified parent will be closed when one of the collapsible item is shown.</p>
  <div class="panel-group" id="accordion">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">미국 USD</a>
        </h4>
      </div>
      <div id="collapse1" class="panel-collapse collapse in">
        <div class="panel-body">
        	<a href="javascript:void(0)" class="on ">
				<h4></h4> 
					<span> 
						<strong>usdkrw ${usdkrw[0].close}</strong>
							<p><i id="upordown"></i>
								<fmt:formatNumber value="${usdkrw[0].close - usdkrw[1].close}"
									pattern="+0.00;-0.00"></fmt:formatNumber>
							</p>
							<p>
								<fmt:formatNumber value="${usdkrw[0].change}" pattern="+0.00%;-0.00%"></fmt:formatNumber>
							</p>
					</span>
							<div id="curve_chart" style="width: 300px; height: 170px"></div>
					
				</a>
    
      
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">일본 JPY</a>
        </h4>
      </div>
      <div id="collapse2" class="panel-collapse collapse">
        <div class="panel-body">
        		<a href="javascript:void(0)" class="on ">
						<h4></h4> 
					<span> 
						<strong>jpykrw ${jpykrw[0].close}</strong>
							<p><i id="upordown"></i>
								<fmt:formatNumber value="${jpykrw[0].close - jpykrw[1].close}"
									pattern="+0.00;-0.00"></fmt:formatNumber>
							</p>
							<p>
								<fmt:formatNumber value="${jpykrw[0].change}" pattern="+0.00%;-0.00%"></fmt:formatNumber>
							</p>
					</span>
				</a>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">중국 CNY</a>
        </h4>
      </div>
      <div id="collapse3" class="panel-collapse collapse">
        <div class="panel-body">
        			<a href="javascript:void(0)" class="on ">
						<h4></h4> 
					<span> 
						<strong>cnykrw ${cnykrw[0].close}</strong>
							<p><i id="upordown"></i>
								<fmt:formatNumber value="${cnykrw[0].close - cnykrw[1].close}"
									pattern="+0.00;-0.00"></fmt:formatNumber>
							</p>
							<p>
								<fmt:formatNumber value="${cnykrw[0].change}" pattern="+0.00%;-0.00%"></fmt:formatNumber>
							</p>
					</span>
				</a>
      </div>
    </div>
  </div> 
</div>

	<!-- google chart -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
			<script type="text/javascript">
			/*마이너스이면 화살표 아래방향으로 바꾼다.*/
			window.onload = function(){
			var close = ${usdkrw[0].close - usdkrw[1].close};
			var ifminus = close.toString().substring(0, 1);
			if (ifminus == '-') {
				document.getElementById('upordown').innerText = '▼';
			} else {
				document.getElementById('upordown').innerHTML = '▲';
			}
			}


			//google chart============================
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
          var data = google.visualization.arrayToDataTable([
          	['year', 'usd/krw'],

	          	//데이터 과거순이기때문에 역순으로 정렬. foreach에 step=-1없다.
	          	<c:forEach var="i" begin="0" end="51" step="1">
	          		<c:set var="date" value="${usdkrw[51-i].stringDate}"/>
	          		<c:set var="close" value="${usdkrw[51-i].close}"/>
	          	     ['${date}', ${close}], //쉼표 안쓰면 오류난다.
	          	</c:forEach> 
            ]);
      
        var options = {
          legend: { position: 'none' }

          //title: 'Company Performance'
          //,legend: { position: 'bottom' }
          //,curveType: 'function'
        };

        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
        chart.draw(data, options);
      }
    </script>
</body>
</html>